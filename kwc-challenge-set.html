<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-image/iron-image.html">
<link rel="import" href="../kwc-button/kwc-button.html">
<link rel="import" href="../web-components/kano-style/kano-style.html">

<!--
`kwc-challenge-set`
To display a set of challenges for the user to complete.

@demo demo/index.html
-->

<dom-module id="kwc-challenge-set">
    <template>
        <style>
            :host {
                @apply --layout-horizontal;
                @apply --layout-centered;
                @apply --layout-around-justified;
                padding: 60px 0;
            }
            .circle-box,
            #progress {
                @apply --layout-flex;
                @apply --layout-horizontal;
                @apply --layout-center;
                @apply --layout-center-justified;
                position: relative;
            }
            .stepCircle.unlocked {
                cursor: pointer;
            }
            image {
                fill: var(--color-white);
                stroke: var(--color-stone);
                stroke-width: 4px;
            }
            image.unlocked {
                fill: var(--color-kano-orange);
                stroke: var(--color-kano-orange);
            }
            .circle-box {
                padding-right: 15px;
            }
            .control-box {
                padding-left: 15px;
            }
            .circle-content {
                position: relative;
            }
            .control-subtitle,
            .control-complete {
                font-size: 16px;
                font-weight: bold;
                color: var(--color-grey);
                margin: 0px;
                padding: 0;
                text-transform: uppercase;
            }
            .control-subtitle {
                color: var(--color-grey);
            }
            .control-complete {
                color: var(--color-kano-orange);
            }
            .control-content {
                font-size: 16px;
                color: var(--color-grey);
                margin: 0px;
                padding: 20px 0;
            }
            .control-title {
                font-weight: bold;
                color: var(--color-abbey);
                font-family: var(--font-body);
                font-size: 20px;
                margin: 0;
            }
            .control-box {
                @apply --layout-flex;
                border-radius: 6px;
                @apply --layout-vertical;
                @apply --layout-center-justified;
                align-items: flex-start;
            }
            .circle-box iron-image {
                width: 120px;
                height: 132px;
                position: absolute;
                @apply --layout-fit;
                margin: auto;
            }
            .control-button {
                margin: 40px 0 0 0;
            }
        </style>
        <div class="circle-box">
            <div class="circle-content">
                <div id="canvas"></div>
                <div id="progress"></div>
                <iron-image src="[[_computeCompleteImage(completed)]]"></iron-image>
            </div>
        </div>
        <div class="control-box">
            <p class="control-title">
                [[challengeSet.title]]
            </p>
            <p class$="[[_computeCompleteClass(completed)]]">
                [[_computeProgressText(progress, completed)]]
            </p>
            <p class="control-content">
                [[challengeSet.description]]
            </p>
            <kwc-button class="control-button"
                hidden$="[[completed]]"
                on-tap="_openNextChallenge"
            >
                continue
            </kwc-button>
            <kwc-button class="control-button"
                hidden$="[[!completed]]"
                on-tap="_openFirstChallenge"
            >
                redo
            </kwc-button>
        </div>
    </template>
    <script>
        Polymer({
            is: 'kwc-challenge-set',
            properties: {
                challengeSet: {
                    type: Object,
                    value: () => {
                        return {};
                    }
                },
                progress: {
                    type: Number,
                    value: 0
                },
                nextChallenge: {
                    type: Object,
                    value: () => {
                        return {};
                    }
                },
                numNodes: {
                    type: Number,
                    computed: '_computeNumNodes(challengeSet)'
                },
                radius: {
                    type: Number,
                    value: 125
                },

                avatarUrl: {
                    type: String,
                    value: null
                },
                _avatarUrl: {
                    type: String,
                    computed: '_computeIconUrl("avatar", avatarUrl)'
                },
                completeIconUrl: {
                    type: String,
                    value: null
                },
                _completeIconUrl: {
                    type: String,
                    computed: '_computeIconUrl("complete", completeIconUrl)'
                },
                currentIconUrl: {
                    type: String,
                    value: null
                },
                _currentIconUrl: {
                    type: String,
                    computed: '_computeIconUrl("current", currentIconUrl)'
                },
                lockedIconUrl: {
                    type: String,
                    value: null
                },
                _lockedIconUrl: {
                    type: String,
                    computed: '_computeIconUrl("locked", lockedIconUrl)'
                },

                completed: {
                    type: Boolean,
                    computed: '_computeComplete(progress, challengeSet.challenges.length)'
                }
            },
            observers:  [
                '_onProgressChanged(progress, challengeSet.*)'
            ],
            attached () {
                this._drawChallengeProgress();
            },
            _computeIconUrl (name, propUrl) {
                if (propUrl){
                    return propUrl
                }
                switch (name) {
                    case "avatar":
                        
                        return "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 181.99 177.35'%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bisolation:isolate%3B%7D.cls-2%2C.cls-5%7Bfill:%23fff%3B%7D.cls-2%7Bstroke:%23fff%3Bstroke-linejoin:round%3Bstroke-width:24px%3B%7D.cls-2%2C.cls-4%7Bstroke-linecap:round%3B%7D.cls-3%7Bfill:%23ffb66f%3B%7D.cls-4%7Bfill:none%3Bstroke:%23000%3Bstroke-miterlimit:10%3Bstroke-width:4px%3Bopacity:0.4%3B%7D.cls-6%7Bfill:%2357473e%3B%7D.cls-7%7Bopacity:0.08%3Bmix-blend-mode:multiply%3B%7D.cls-8%7Bfill:%23515451%3B%7D.cls-9%7Bfill:%23626662%3B%7D.cls-10%7Bfill:%235d5c58%3B%7D.cls-11%7Bfill:%236b6a65%3B%7D.cls-12%7Bfill:%23ffce9e%3B%7D%3C/style%3E%3C/defs%3E%3Ctitle%3Esetup-judoka%3C/title%3E%3Cg class='cls-1'%3E%3Cg id='Layer_2' data-name='Layer 2'%3E%3Cg id='Layer_1-2' data-name='Layer 1'%3E%3Cpath class='cls-2' d='M165.7 116.8c.12-.36.25-.7.36-1.07.2-.6.4-1.23.57-1.84l.27-.9q.4-1.4.74-2.8A79 79 0 0 0 150 38.5a79.5 79.5 0 0 0-17.72-14.84 78.3 78.3 0 0 0-34.86-11.4c-2.15-.2-4.32-.28-6.5-.28a78.9 78.9 0 0 0-61 28.76l-.38.44a1.83 1.83 0 0 0 .37.5l1.5 1.5c-1 .52-2.1 1.1-3.2 1.72a2.35 2.35 0 0 0-.5.37c-2.1 2.06-18.1 19-15.4 43.15v.2s0 .24.1.36a53.33 53.33 0 0 0 3.7 13.8 2.4 2.4 0 0 0 .3.48l.1.1a2.3 2.3 0 0 0 .26.26l.13.1.26.2.14.08h.07a2.22 2.22 0 0 0 2.36-.34l.73-.62a70.5 70.5 0 0 0 137.87 11.1 48.58 48.58 0 0 1 3.8 6.18 2.2 2.2 0 0 0 1.84 1.23l.45-1.18v.05l.33-.94.43-1.1c.2-.56.4-1.1.57-1.66z'/%3E%3Ccircle class='cls-3' cx='90.39' cy='94.84' r='70.51'/%3E%3Cpath class='cls-4' d='M108.84 115.05a24.8 24.8 0 0 1-36.84-.9'/%3E%3Cpath class='cls-5' d='M64.64 101.83c0 4.76-3.2 4.92-7.57 4.83h-5.63c-4.37.1-7.56-.07-7.56-4.83a10.38 10.38 0 0 1 20.76 0z'/%3E%3Cpath class='cls-6' d='M59 102.83a4.72 4.72 0 0 1-1.94 3.83h-5.63a4.75 4.75 0 1 1 7.57-3.83z'/%3E%3Ccircle class='cls-5' cx='50.58' cy='99.83' r='1.78'/%3E%3Cpath class='cls-5' d='M136.9 101.83c0 4.76-3.2 4.92-7.56 4.83h-5.63c-4.3.1-7.5-.07-7.5-4.83a10.38 10.38 0 0 1 20.8 0z'/%3E%3Cpath class='cls-6' d='M131.28 102.83a4.72 4.72 0 0 1-1.94 3.83h-5.63a4.75 4.75 0 1 1 7.6-3.83z'/%3E%3Ccircle class='cls-5' cx='122.85' cy='99.83' r='1.78'/%3E%3Cpath class='cls-7' d='M160.8 94.65v.74a69.43 69.43 0 0 1-7 29.8v.1c-12.4-22.6-39-27.6-63.4-36C70 82.2 47.44 58.5 36.6 46c-.1-.1-.17-.2-.26-.3.12-.15.26-.3.37-.47a3.07 3.07 0 0 1 .5-.48l.6-.47c39.9-29.67 82.2-21.2 106.1 4.6a70.07 70.07 0 0 1 16.9 45.75z'/%3E%3Cpath class='cls-8' d='M27.73 45.28C25.25 47.75 3 71.18 16.1 102.8a2.28 2.28 0 0 0 3.57.92c5.86-5 20.84-18.65 22.15-28.35s6.67-27 8.82-33.8a2.25 2.25 0 0 0-2.18-2.95c-3.88.07-11.15 1.06-20.25 6.27a2.36 2.36 0 0 0-.4.3z'/%3E%3Cpath class='cls-9' d='M50.64 41.57c-.15.46-.3 1-.5 1.54a2.33 2.33 0 0 0-1.66-.3c-4.13.6-11.76 2.6-20.8 9.3a2.37 2.37 0 0 0-.47.5c-2 2.6-18.3 24.5-9.8 51.6a2.32 2.32 0 0 1-1.2-1.25C3 71.2 25.3 47.78 27.7 45.3a2.64 2.64 0 0 1 .5-.38c9.1-5.22 16.36-6.2 20.24-6.27a2.25 2.25 0 0 1 2.18 2.94z'/%3E%3Cpath class='cls-10' d='M150 38.53a79.06 79.06 0 0 0-120.43 2.65 1.83 1.83 0 0 0 .37.52c7.5 7.66 37.9 37.4 62.86 43.67 26.86 6.7 55.8 9.24 69.2 35a2.2 2.2 0 0 0 1.88 1.23 75.76 75.76 0 0 0 3.75-11.35A79.13 79.13 0 0 0 150 38.53z'/%3E%3Cpath class='cls-11' d='M170 91.07a78.5 78.5 0 0 1-2.35 19.16 75.6 75.6 0 0 1-3.3 10.25c.53-2.7 1-5.45 1.24-8.25A90.5 90.5 0 0 0 151.4 53a81.23 81.23 0 0 0-37.46-31 75.82 75.82 0 0 0-75.7 11.26 83.17 83.17 0 0 0-8.67 7.92A79.07 79.07 0 0 1 170 91.08z'/%3E%3Ccircle class='cls-12' cx='47.28' cy='115.08' r='2.41'/%3E%3Ccircle class='cls-12' cx='133.51' cy='115.08' r='2.41'/%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E"
                
                    case "current":
                        
                        return "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 53.81 53.81'%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23ffb300%3B%7D.cls-2%7Bfill:%23ff6900%3B%7D.cls-3%7Bfill:%2366d8fb%3B%7D%3C/style%3E%3C/defs%3E%3Ctitle%3EAsset 31%3C/title%3E%3Cg id='Layer_2' data-name='Layer 2'%3E%3Cg id='Layer_4' data-name='Layer 4'%3E%3Cpath class='cls-1' d='M26.9 53.8a26.9 26.9 0 1 1 26.9-26.9 26.93 26.93 0 0 1-26.9 26.9z'/%3E%3Ccircle class='cls-2' cx='26.9' cy='26.9' r='21.82'/%3E%3Ccircle class='cls-3' cx='26.84' cy='26.85' r='19.73'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"
                
                    case "complete": 
                        
                        return "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45.09 47.65'%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bisolation:isolate%3B%7D.cls-2%7Bopacity:0.04%3B%7D.cls-2%2C.cls-6%2C.cls-8%7Bmix-blend-mode:multiply%3B%7D.cls-3%7Bfill:%23f2ba00%3B%7D.cls-4%7Bfill:%23ffd500%3B%7D.cls-5%7Bfill:%23ffea00%3B%7D.cls-6%7Bopacity:0.07%3B%7D.cls-11%2C.cls-7%7Bfill:%23fff%3B%7D.cls-8%7Bopacity:0.12%3B%7D.cls-9%7Bfill:%23f06000%3B%7D.cls-10%7Bfill:%23f70%3B%7D.cls-11%7Bopacity:0.15%3B%7D%3C/style%3E%3C/defs%3E%3Ctitle%3EStep-Star-1%3C/title%3E%3Cg class='cls-1'%3E%3Cg id='Layer_2' data-name='Layer 2'%3E%3Cg id='Layer_1-2' data-name='Layer 1'%3E%3Cpath class='cls-2' d='M45.1 25.07a22.47 22.47 0 1 1-2.3-9.9 22.54 22.54 0 0 1 2.3 9.9z'/%3E%3Cpath class='cls-3' d='M45.1 23.9a22.47 22.47 0 1 1-2.3-9.9 22.54 22.54 0 0 1 2.3 9.9z'/%3E%3Cpath class='cls-4' d='M45.1 22.5a22.56 22.56 0 0 1-31.85 20.6l-.57-.28a22.52 22.52 0 0 1-3.37-2l-.2-.16a23 23 0 0 1-1.8-1.5 22.66 22.66 0 0 1-4.9-6.7L2 31.9A22.55 22.55 0 0 1 31.84 2l.57.27a22.64 22.64 0 0 1 6.6 4.9v.05A22.93 22.93 0 0 1 40.6 9l.16.2a22.34 22.34 0 0 1 2 3.37l.27.57a22.47 22.47 0 0 1 2.06 9.37z'/%3E%3Cpath class='cls-5' d='M39.08 7.22l-31.8 31.9H7.2a22.66 22.66 0 0 1-4.92-6.65L2 31.9 31.84 2l.57.27a22.64 22.64 0 0 1 6.6 4.9zm3.98 5.98l-29.8 29.9-.58-.28a22.52 22.52 0 0 1-3.37-2L40.8 9.25a22.34 22.34 0 0 1 2 3.36z'/%3E%3Cpath class='cls-3' d='M41.7 22.5A19.16 19.16 0 1 1 22.52 3.4 19.12 19.12 0 0 1 41.7 22.5z'/%3E%3Cpath class='cls-5' d='M41.7 23.56a19.16 19.16 0 1 1-38.3.06v-.52a19.15 19.15 0 0 0 38.3-.1v.56z'/%3E%3Cpath class='cls-6' d='M3.4 22.57v.7a19.15 19.15 0 0 1 38.27-.06v-.7a19.16 19.16 0 1 0-38.3.1z'/%3E%3Cpath class='cls-6' d='M38.76 23.8a16.22 16.22 0 0 1-31.68 4.9L7 28.4a16.2 16.2 0 0 1 28-15 16.17 16.17 0 0 1 3.43 7 16.24 16.24 0 0 1 .33 3.4z'/%3E%3Cpath class='cls-3' d='M38.76 22.94a16.22 16.22 0 0 1-31.68 4.92l-.08-.3a16.2 16.2 0 0 1 28-15 16.17 16.17 0 0 1 3.43 7 16.24 16.24 0 0 1 .33 3.38z'/%3E%3Cpath class='cls-4' d='M38.77 22.1A16.24 16.24 0 0 1 19.17 38l-.67-.16a16 16 0 0 1-4-1.66l-.33-.2a16.43 16.43 0 0 1-1.94-1.4l-.2-.16A16.26 16.26 0 0 1 7.08 27v-.14L7 26.7A16.23 16.23 0 0 1 22.52 5.9a16.1 16.1 0 0 1 4.57.65h.1a16.24 16.24 0 0 1 7.5 4.92l.13.2a16 16 0 0 1 1.4 1.94l.2.4a16.07 16.07 0 0 1 1.67 4l.17.7a16.37 16.37 0 0 1 .4 3.5z'/%3E%3Cpath class='cls-5' d='M34.8 11.5L12 34.4A16.26 16.26 0 0 1 7.08 27v-.14L27.25 6.6a16.24 16.24 0 0 1 7.56 4.9zm3.44 6.5L18.5 37.83a16 16 0 0 1-4-1.66l-.33-.2 22.2-22.32.2.34a16.07 16.07 0 0 1 1.67 4z'/%3E%3Cpath class='cls-7' d='M36.54 11.95a1.83 1.83 0 0 0-1.7 1.7.2.2 0 0 1-.4 0 1.83 1.83 0 0 0-1.7-1.7.2.2 0 0 1 0-.4 1.83 1.83 0 0 0 1.7-1.7.2.2 0 0 1 .4 0 1.83 1.83 0 0 0 1.7 1.7.2.2 0 0 1 0 .4z'/%3E%3Ccircle class='cls-7' cx='16.99' cy='25.57' r='.58'/%3E%3Cpath d='M28.44 33a1.55 1.55 0 0 1-.5.08 1.73 1.73 0 0 1-.72-.18l-4.72-2.42L17.8 33l-.25.1a1.57 1.57 0 0 1-1.4-.2 1.6 1.6 0 0 1-.63-1.53l.87-5.26-3.9-3.6a1.56 1.56 0 0 1 .6-2.6h.2l5.3-.8 2.3-4.8a1.57 1.57 0 0 1 .9-.8 1.6 1.6 0 0 1 1.9.8l2.4 4.7 5.3.74a1.56 1.56 0 0 1 1.3 1 1.6 1.6 0 0 1-.4 1.6L28.53 26l.94 5.23a1.58 1.58 0 0 1-1 1.76' class='cls-8'/%3E%3Cpath class='cls-9' d='M32.8 17.67h-.93v.53a1.48 1.48 0 0 0-.43-.12l-5.28-.73-2.38-4.75a1.6 1.6 0 0 0-1.92-.78 1.57 1.57 0 0 0-.9.8l-2.3 4.8-5.28.8-.27.06-.1.06v-.67h-.9v2a1.55 1.55 0 0 0 .5 1.2l3.9 3.68-.6 3.45h-.3v2.08a1.6 1.6 0 0 0 .67 1.28 1.57 1.57 0 0 0 1.4.2l.25-.1 4.7-2.52 4.7 2.45a1.73 1.73 0 0 0 .75.1 1.52 1.52 0 0 0 .92-.3 1.53 1.53 0 0 0 .6-1.2v-2h-.33l-.63-3.58 3.8-3.75a1.57 1.57 0 0 0 .45-1z'/%3E%3Cpath class='cls-10' d='M28.44 29.48a1.55 1.55 0 0 1-.5.08 1.73 1.73 0 0 1-.72-.18l-4.72-2.44-4.7 2.5-.25.12a1.57 1.57 0 0 1-1.4-.2 1.6 1.6 0 0 1-.63-1.54l.87-5.26-3.9-3.68a1.56 1.56 0 0 1 .6-2.6l.2-.06 5.3-.8 2.3-4.8a1.57 1.57 0 0 1 .9-.8 1.6 1.6 0 0 1 1.9.78l2.4 4.76 5.3.73a1.56 1.56 0 0 1 1.3 1 1.6 1.6 0 0 1-.4 1.6l-3.8 3.7.9 5.2a1.58 1.58 0 0 1-1 1.7'/%3E%3Cpath class='cls-11' d='M15.43 27.83a1.6 1.6 0 0 0 .63 1.54 1.57 1.57 0 0 0 1.4.2l.25-.1 4.7-2.52 4.8 2.45a1.73 1.73 0 0 0 .8.18 1.57 1.57 0 0 0 1.54-1.84l-.94-5.23 3.77-3.7a1.6 1.6 0 0 0 .4-1.6 1.56 1.56 0 0 0-1.27-1l-5-.7-10.7 10.6z'/%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E";
                
                    case "locked": 
                        
                        return "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 45.1 47.65'%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23f9f9f9%3B%7D.cls-2%7Bfill:%23d3d3d3%3B%7D.cls-3%7Bfill:%23dfdfdf%3B%7D.cls-4%7Bfill:%23e7e7e7%3B%7D.cls-5%7Bfill:%23d7d7d7%3B%7D.cls-6%7Bfill:%23cbcbcb%3B%7D.cls-7%7Bfill:%23dedede%3B%7D.cls-8%7Bfill:%23fff%3B%7D.cls-9%7Bfill:%23d0d0d0%3B%7D.cls-10%7Bfill:%23b3b3b3%3B%7D.cls-11%7Bfill:%23bebebe%3B%7D.cls-12%7Bfill:%23ebebeb%3B%7D.cls-13%7Bfill:%23bfbfbf%3B%7D.cls-14%7Bfill:%23c8c8c8%3B%7D%3C/style%3E%3C/defs%3E%3Ctitle%3EStep-Star-0%3C/title%3E%3Cg id='Layer_2' data-name='Layer 2'%3E%3Cg id='Layer_1-2' data-name='Layer 1'%3E%3Cpath class='cls-1' d='M45.09 24.43a22.54 22.54 0 0 1-22.5 22A22.47 22.47 0 0 1 9.1 42a22.62 22.62 0 0 1-6.8-8.13A22.45 22.45 0 0 1 0 24.59v.55a22.5 22.5 0 0 0 7.23 16.5A23.19 23.19 0 0 0 9.1 43.2a22.49 22.49 0 0 0 13.45 4.45A22.55 22.55 0 0 0 45.1 25.07v-.64'/%3E%3Cpath class='cls-2' d='M45.08 23.23a22.55 22.55 0 0 1-22.5 21.86 22.46 22.46 0 0 1-9.29-2l-.57-.27a22.51 22.51 0 0 1-3.37-2l-.22-.16a23 23 0 0 1-1.82-1.51h-.05a22.65 22.65 0 0 1-4.96-6.68L2 31.9a22.47 22.47 0 0 1-2-8.62v1.31a22.49 22.49 0 0 0 7.23 15.89 22.59 22.59 0 0 0 5.45 3.74 22.45 22.45 0 0 0 9.87 2.27 22.54 22.54 0 0 0 22.5-22v-1.21'/%3E%3Cpath class='cls-3' d='M15.84 40.59a19 19 0 0 0 5.91 1.19 19 19 0 0 1-5.91-1.19M39.08 7.22l-2.4 2.41a19.29 19.29 0 0 1 1.64 2.06l2.43-2.44L40.6 9a22.7 22.7 0 0 0-1.51-1.81M22.56 0A22.54 22.54 0 0 0 0 22.58v.7a22.47 22.47 0 0 0 2 8.62l.27.57a22.65 22.65 0 0 0 4.92 6.61h.05a23 23 0 0 0 1.82 1.51l.22.16a22.51 22.51 0 0 0 3.37 2l.57.27a22.46 22.46 0 0 0 9.29 2 22.55 22.55 0 0 0 22.5-21.86v-.72a22.46 22.46 0 0 0-2-9.32l-2.59 2.6a19.06 19.06 0 0 1 1.23 6.73v1.04a19.18 19.18 0 0 1-19.07 19.25 19.05 19.05 0 0 1-7.45-1.51l-1.85 1.85-.57-.27a22.51 22.51 0 0 1-3.37-2l1.8-1.81a19.26 19.26 0 0 1-2-1.71l-1.87 1.84h-.05a22.65 22.65 0 0 1-4.92-6.66L2 31.9l2.32-2.33a19.08 19.08 0 0 1-1-6v-1.04A19.18 19.18 0 0 1 22.51 3.39a19.06 19.06 0 0 1 6.7 1.21L31.84 2a22.4 22.4 0 0 0-9.28-2'/%3E%3Cpath class='cls-4' d='M4.35 29.57L2 31.9l.27.57a22.65 22.65 0 0 0 4.92 6.61h.05l1.87-1.87a19.19 19.19 0 0 1-4.79-7.68M31.84 2l-2.59 2.6a19.22 19.22 0 0 1 7.44 5l2.4-2.41v-.05a22.64 22.64 0 0 0-6.63-4.9L31.84 2m-17.5 37.85q.74.35 1.5.64-.77-.29-1.5-.64m-.09 0h.07-.07m-.25-.16l.22.11-.22-.11m-.08 0h.05-.05M11.14 39l-1.83 1.8a22.51 22.51 0 0 0 3.37 2l.57.27 1.85-1.85a19.16 19.16 0 0 1-4-2.27m29.65-29.7l-2.43 2.44a19.13 19.13 0 0 1 2.15 4.09l2.59-2.6-.27-.57a22.31 22.31 0 0 0-2-3.36'/%3E%3Cpath class='cls-2' d='M6.33 22.55v-.41A16.24 16.24 0 0 1 22.52 5.9a16.13 16.13 0 0 1 4.53.65h.17a16.22 16.22 0 0 1 6.87 4.17 2.83 2.83 0 0 0 .33-.91.2.2 0 0 1 .39 0 1.83 1.83 0 0 0 1.7 1.7.2.2 0 0 1 0 .39 2.51 2.51 0 0 0-1 .42q.47.62.88 1.28l.2.34a16.07 16.07 0 0 1 1.67 4c.06.22.11.44.16.67a16.44 16.44 0 0 1 .37 3.4v1.7A16.21 16.21 0 0 1 22.57 40a16.2 16.2 0 0 1-3.37-.35 16 16 0 0 1-4.71-1.81 16.31 16.31 0 0 1-7.37-9.16L7 28.41a16.19 16.19 0 0 1-.66-4.57v-1.29M22.55 4.78A19.18 19.18 0 0 0 3.4 23.27a19.18 19.18 0 0 0 9.86 16h.44l.22.11h.07q.74.35 1.5.64a19 19 0 0 0 5.91 1.19h3.07A19.18 19.18 0 0 0 41.69 23.2 19.18 19.18 0 0 0 22.55 4.78m0-1.39A19.18 19.18 0 0 1 41.7 22.51v-.01a19.05 19.05 0 0 0-3.38-10.82 19.28 19.28 0 0 0-9.07-7.08 19.06 19.06 0 0 0-6.7-1.21'/%3E%3Cpath class='cls-4' d='M41.69 23.06v.15A19.18 19.18 0 0 1 24.5 41.6h-2.75a19 19 0 0 1-5.91-1.19q-.77-.29-1.5-.64h-.07l-.27-.08h-.44a19.18 19.18 0 0 1-9.86-16v-.15.5a19.16 19.16 0 0 0 18.85 18.7A19.18 19.18 0 0 0 41.7 23.56v-.48'/%3E%3Cpath class='cls-5' d='M22.54 3.39A19.18 19.18 0 0 0 3.39 22.57 19.18 19.18 0 0 1 22.52 3.39'/%3E%3Cpath class='cls-6' d='M22.54 3.39A19.18 19.18 0 0 0 3.39 22.57v.69A19.18 19.18 0 0 1 22.52 4.78 19.18 19.18 0 0 1 41.69 23.2v-.69A19.18 19.18 0 0 0 22.54 3.39'/%3E%3Cpath class='cls-7' d='M3.4 23.1v.15-.15m38.29-.1v.01'/%3E%3Cpath class='cls-6' d='M6.33 23.39v.45A16.19 16.19 0 0 0 7 28.41l.09.3a16.31 16.31 0 0 0 7.37 9.16 16 16 0 0 0 4.71 1.81 16.2 16.2 0 0 0 3.37.35 16.21 16.21 0 0 0 16.22-16.24v-.4a16.21 16.21 0 0 1-16.19 15.8A16.09 16.09 0 0 1 14.45 37a16.31 16.31 0 0 1-7.37-9.16L7 27.56a16.16 16.16 0 0 1-.66-4.17'/%3E%3Cpath class='cls-2' d='M6.33 22.55v.84A16.16 16.16 0 0 0 7 27.56l.09.3A16.31 16.31 0 0 0 14.45 37a16.09 16.09 0 0 0 8.08 2.17 16.21 16.21 0 0 0 16.23-15.78v-.83a16.21 16.21 0 0 1-16.19 15.78 16.16 16.16 0 0 1-3.4-.34l-.67-.16a16 16 0 0 1-4-1.66l-.34-.2a16.49 16.49 0 0 1-1.94-1.39l-.2-.17A16.27 16.27 0 0 1 7.08 27v-.14L7 26.71a16.26 16.26 0 0 1-.66-4.16'/%3E%3Cpath class='cls-3' d='M35.5 12.37a2 2 0 0 0-.65 1.28.2.2 0 0 1-.39 0 2.17 2.17 0 0 0-.57-1.2l-3.49 3.5 1.05.14a1.56 1.56 0 0 1 1.28 1v.14l3.62-3.63q-.35-.6-.85-1.23M22.56 5.9A16.24 16.24 0 0 0 6.32 22.14v.41A16.26 16.26 0 0 0 7 26.71l.05.17v.14a16.27 16.27 0 0 0 4.9 7.4l.2.17A16.49 16.49 0 0 0 14.12 36l.34.2a16 16 0 0 0 4 1.66l.67.16a16.16 16.16 0 0 0 3.36.35 16.21 16.21 0 0 0 16.27-15.81v-.47a16.44 16.44 0 0 0-.37-3.4c0-.22-.1-.45-.16-.67L29.34 27l.14.77a1.54 1.54 0 0 1 0 .44v1.93a1.6 1.6 0 0 1-.13.55l.11.63a1.58 1.58 0 0 1-1 1.76 1.56 1.56 0 0 1-.49.08 1.74 1.74 0 0 1-.73-.18l-2.53-1.31-6.21 6.16a16 16 0 0 1-4-1.66l-.34-.2 2.78-2.79a1.57 1.57 0 0 1-.75-.28 1.61 1.61 0 0 1-.63-1.54l.1-.61L12 34.41A16.27 16.27 0 0 1 7.08 27v-.14l5.09-5.1a1.59 1.59 0 0 1 0-.94 1.61 1.61 0 0 1 .13-.3 1.58 1.58 0 0 1-.2-.85v-1.76a1.59 1.59 0 0 1 .06-.61 1.57 1.57 0 0 1 1-1l.27-.06 5.05-.77.4-.4L21 10.61a1.58 1.58 0 0 1 .9-.8 1.59 1.59 0 0 1 1.71.47l3.64-3.68h-.17a16.13 16.13 0 0 0-4.53-.65'/%3E%3Cpath class='cls-4' d='M12.12 21.77L7 26.88v.14a16.27 16.27 0 0 0 4.9 7.4l3.64-3.65v-.08a1.66 1.66 0 0 1-.12-.6v-1.5a1.61 1.61 0 0 1-.07-.76l.29-1.73.1-.1.06-.37-3.35-3.2a1.54 1.54 0 0 1-.4-.65M18.83 15l-.4.4h.22l.18-.37m8.42-8.43l-3.68 3.69a1.54 1.54 0 0 1 .21.31l2.38 4.77 4.23.58 3.49-3.5a2.3 2.3 0 0 0-1.13-.45.2.2 0 0 1 0-.39 1.89 1.89 0 0 0 1.37-.79 16.22 16.22 0 0 0-6.87-4.22M22.5 30.48L17.8 33l-.25.11a1.55 1.55 0 0 1-.5.08h-.15L14.12 36l.34.2a16 16 0 0 0 4 1.66l6.19-6.21-2.15-1.17m13.87-16.83l-3.62 3.63a1.62 1.62 0 0 1 0 .4v2.08a1.65 1.65 0 0 1-.19.63 1.56 1.56 0 0 1 .14.3 1.59 1.59 0 0 1-.4 1.6l-3.24 3.21.28 1.5 8.9-9a16.07 16.07 0 0 0-1.67-4l-.2-.34'/%3E%3Cpath class='cls-8' d='M34.64 9.7a.2.2 0 0 0-.2.16 2.83 2.83 0 0 1-.33.91 1.89 1.89 0 0 1-1.37.79.2.2 0 0 0 0 .39 2.3 2.3 0 0 1 1.13.49 2.17 2.17 0 0 1 .57 1.2.2.2 0 0 0 .39 0 2 2 0 0 1 .65-1.28 2.51 2.51 0 0 1 1-.42.2.2 0 0 0 0-.39 1.83 1.83 0 0 1-1.7-1.7.2.2 0 0 0-.2-.16'/%3E%3Cpath class='cls-5' d='M32.58 20.38a1.47 1.47 0 0 1-.26.35l-3.48 3.45.24 1.31 3.24-3.21a1.59 1.59 0 0 0 .4-1.6 1.56 1.56 0 0 0-.14-.3'/%3E%3Cpath class='cls-9' d='M12.26 20.53a1.61 1.61 0 0 0-.13.3 1.59 1.59 0 0 0 0 .94l.65-.65-.25-.24a1.52 1.52 0 0 1-.27-.35'/%3E%3Cpath class='cls-5' d='M12.78 21.12l-.65.65a1.54 1.54 0 0 0 .4.65l3.35 3.2.22-1.33-3.32-3.17'/%3E%3Cpath class='cls-9' d='M25.7 30.6l-1 1 2.53 1.31a1.74 1.74 0 0 0 .73.18 1.52 1.52 0 0 0 .93-.31 1.55 1.55 0 0 0 .6-1.53l-.11-.63a1.48 1.48 0 0 1-.49.62 1.52 1.52 0 0 1-.93.31 1.73 1.73 0 0 1-.73-.18l-1.53-.77m-6.14-.09l-1.76.94-.25.11a1.55 1.55 0 0 1-.5.08 1.49 1.49 0 0 1-1.4-.92l-.1.61a1.61 1.61 0 0 0 .63 1.54 1.57 1.57 0 0 0 .75.28l2.66-2.67'/%3E%3Cpath class='cls-5' d='M15.63 30.69v.08m6.87-1.83l-2.93 1.57-2.67 2.67h.15a1.55 1.55 0 0 0 .5-.08l.25-.1 4.7-2.52 2.19 1.14 1-1-3.2-1.66'/%3E%3Cpath class='cls-10' d='M22.46 27l-4.66 2.45-.25.11a1.55 1.55 0 0 1-.5.08H17a1.57 1.57 0 0 1-.9-.28 1.61 1.61 0 0 1-.57-.78v1.5a1.66 1.66 0 0 0 .12.6 1.54 1.54 0 0 0 1.9.84l.25-.11 1.76-.94 2.93-1.57 3.2 1.66 1.51.79a1.73 1.73 0 0 0 .73.18 1.52 1.52 0 0 0 .93-.31 1.48 1.48 0 0 0 .49-.62 1.6 1.6 0 0 0 .13-.55v-1.89a1.6 1.6 0 0 1-1.06 1.32 1.57 1.57 0 0 1-.49.08h-.08a1.72 1.72 0 0 1-.73-.18L22.46 27m-10.4-9.06v1.77a1.58 1.58 0 0 0 .2.85 1.52 1.52 0 0 0 .27.35l.25.24 3.32 3.15.29-1.73-3.86-3.68a1.55 1.55 0 0 1-.47-1m20.73-.23a1.58 1.58 0 0 1-.47 1.06l-3.78 3.75.31 1.7 3.48-3.45a1.47 1.47 0 0 0 .26-.35 1.65 1.65 0 0 0 .19-.63v-2.07'/%3E%3Cpath class='cls-11' d='M22.41 26.94l-4.7 2.52-.25.11a1.55 1.55 0 0 1-.46.08 1.55 1.55 0 0 0 .5-.08l.25-.11L22.46 27m0-17.21a1.61 1.61 0 0 0-.5.08 1.58 1.58 0 0 0-.9.8L18.83 15l-.18.37h-.22l-5.05.77-.27.06a1.57 1.57 0 0 0-1 1 1.59 1.59 0 0 0-.06.61 1.55 1.55 0 0 0 .47 1l3.86 3.68-.28 1.81-.22 1.33-.06.37 10.59-10.59 5 .68a1.56 1.56 0 0 1 1.28 1 1.59 1.59 0 0 1-.4 1.6l-3.78 3.75.94 5.23a1.55 1.55 0 0 1-.61 1.53 1.53 1.53 0 0 1-.44.23 1.56 1.56 0 0 1-.44.08 1.57 1.57 0 0 0 .49-.08 1.56 1.56 0 0 0 1-1.76l-.11-.67-.26-1.46-.24-1.31-.31-1.7 3.78-3.75a1.58 1.58 0 0 0 .47-1.06 1.62 1.62 0 0 0 0-.4v-.14a1.56 1.56 0 0 0-1.28-1l-1.05-.14-4.23-.58-2.44-4.86a1.54 1.54 0 0 0-.21-.31 1.61 1.61 0 0 0-1.21-.56'/%3E%3Cpath class='cls-12' d='M15.82 26l-.1.1-.29 1.73a1.61 1.61 0 0 0 .07.76v-.55a1.63 1.63 0 0 1 0-.18l.3-1.83'/%3E%3Cpath class='cls-13' d='M15.5 28.11v.48a1.61 1.61 0 0 0 .57.78 1.57 1.57 0 0 0 .9.28 1.58 1.58 0 0 1-.86-.28 1.61 1.61 0 0 1-.65-1.26m7-1.17l4.68 2.42a1.72 1.72 0 0 0 .73.18 1.73 1.73 0 0 1-.7-.17l-4.67-2.43'/%3E%3Cpath class='cls-14' d='M26.41 15.41L15.82 26l-.3 1.83a1.63 1.63 0 0 0 0 .18v.07a1.61 1.61 0 0 0 .65 1.26 1.58 1.58 0 0 0 .86.28 1.55 1.55 0 0 0 .46-.08l.25-.11 4.7-2.52 4.72 2.45a1.73 1.73 0 0 0 .7.17 1.56 1.56 0 0 0 .44-.08 1.53 1.53 0 0 0 .44-.23 1.55 1.55 0 0 0 .61-1.53l-.94-5.23 3.78-3.75a1.59 1.59 0 0 0 .4-1.6 1.56 1.56 0 0 0-1.28-1l-5-.68'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E";
                
                    default:
                        return;
                }

            },
            _computeButtonText (completed) {
                return completed ? 'redo' : 'continue';
            },
            _computeComplete (progress, total) {
                return progress >= total;
            },
            _computeProgressText (progress, completed) {
                if (!this.challengeSet || !this.challengeSet.challenges) {
                    return '0 / 0';
                }
                if (!completed) {
                    return `${progress || 0} / ${this.challengeSet.challenges.length}`;
                } else {
                    return 'complete';
                }
            },
            _computeNumNodes (challengeSet) {
                if (!challengeSet || !challengeSet.challenges) {
                    return 0;
                }
                return challengeSet.challenges.length;
            },
            _computeCompleteClass (completed) {
                return completed ? 'control-complete' : 'control-subtitle';
            },
            _computeCompleteImage (completed) {
                return completed ? this.challengeSet['medal-enabled'] : this.challengeSet['medal-disabled'];
            },
            _createNodes (_numNodes, _radius) {
                let nodes = [],
                    width = (_radius * 2) + 50,
                    height = (_radius * 2) + 50,
                    angle,
                    x,
                    y,
                    i;

                for (i = 0; i < _numNodes; i++) {
                    angle = ((i / (_numNodes / 2)) * Math.PI) - (90 * (Math.PI / 180)) + (2 * (Math.PI / _numNodes));
                    x = (_radius * Math.cos(angle)) + (width / 2);
                    y = (_radius * Math.sin(angle)) + (width / 2);
                    nodes.push({'id': i, 'x': x, 'y': y});
                }
                return nodes;
            },
            _createChallengeSvg (_radius, callback) {
                let svgContainer = this.$.progress,
                    xmlns = 'http://www.w3.org/2000/svg',
                    svg = document.createElementNS(xmlns, 'svg');
                svgContainer.innerHTML = '';
                svg.setAttribute('width', (_radius * 2) + 50);
                svg.setAttribute('height', (_radius * 2) + 50);
                svg.setAttribute('id', 'progressContainer');
                svgContainer.append(svg);
                callback(svg);
            },
            _drawStepCircles (svg, nodes, elementRadius) {
                let xmlns = 'http://www.w3.org/2000/svg',
                    element = svg;
                if (!this.progress) {
                    this.progress = 0;
                }
                for (let i = 0; i < nodes.length; i++) {
                    let stepCircle = document.createElementNS(xmlns, 'image');
                    stepCircle.setAttribute('index', i);
                    stepCircle.setAttribute('class', 'stepCircle');
                    stepCircle.setAttributeNS(null, 'height', '50');
                    stepCircle.setAttributeNS(null, 'width', '50');
                    stepCircle.setAttribute('x', (nodes[i].x - 25));
                    stepCircle.setAttribute('y', (nodes[i].y - 25));
                    stepCircle.onclick = this._onChallengeClick.bind(this);
                    if (i < this.progress) {
                        stepCircle.setAttribute('class', 'stepCircle unlocked');
                        stepCircle.setAttributeNS(null, 'href', this._completeIconUrl);
                        element.append(stepCircle);
                    } else if (i === this.progress) {
                        stepCircle.setAttributeNS(null, 'href', this._currentIconUrl);
                        stepCircle.setAttribute('class', 'stepCircle unlocked');
                        let avatar = document.createElementNS(xmlns, 'image');
                        avatar.setAttributeNS(null, 'height', '25');
                        avatar.setAttributeNS(null, 'width', '25');
                        avatar.setAttributeNS(null, 'href', this._avatarUrl);
                        avatar.setAttribute('cursor', 'pointer');
                        avatar.setAttribute('x', (nodes[i].x - 12));
                        avatar.setAttribute('y', (nodes[i].y - 12));
                        avatar.setAttribute('index', i);
                        avatar.onclick = this._onChallengeClick.bind(this);
                        element.append(stepCircle);
                        element.append(avatar);
                    } else {
                        stepCircle.setAttributeNS(null, 'href', this._lockedIconUrl);
                        element.append(stepCircle);
                    }
                }
            },
            _describeArc (x, y, radius, startAngle, endAngle) {
                endAngle = endAngle || 360;
                let start = this._polarToCartesian(x, y, radius, endAngle),
                    end = this._polarToCartesian(x, y, radius, startAngle),
                    largeArcFlag = endAngle - startAngle <= 180 ? '0' : '1',
                    d = [
                        'M', start.x, start.y,
                        'A', radius, radius, 0, largeArcFlag, 0, end.x, end.y
                    ].join(' ');
                return d;
            },
            _polarToCartesian (centerX, centerY, radius, angleInDegrees) {
                let angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0;
                return {
                        x: centerX + (radius * Math.cos(angleInRadians)),
                        y: centerY + (radius * Math.sin(angleInRadians))
                    };
            },
            _drawChallengeProgress () {
                let nodes = this._createNodes(this.numNodes, this.radius),
                    xmlns = 'http://www.w3.org/2000/svg';
                if (!nodes.length){ return; }
                this._createChallengeSvg(this.radius,  svg => {
                    let polyline = document.createElementNS(xmlns, 'polyline');
                    polyline.style.strokeDasharray = 4.5;

                    polyline.setAttribute('points',
                        nodes[this.numNodes - 1].x + ',' + nodes[this.numNodes - 1].y + ' ' + nodes[this.numNodes - 1].x + ',' + (nodes[this.numNodes - 1].y + this.radius / 2) + ' '
                    );
                    polyline.setAttribute('stroke', '#e0e1e3');
                    polyline.setAttribute('stroke-width', 7);
                    if (this.completed) {
                        polyline.setAttribute('stroke', '#ffb300');
                        polyline.style.strokeDasharray = 'none';
                    }
                    element = svg;
                    element.append(polyline);
                    let arc = document.createElementNS(xmlns, 'path');
                    arc.setAttribute('d', this._describeArc(
                        this.radius + 25,
                        this.radius + 25,
                        this.radius,
                        360 / this.numNodes,
                        360));
                    arc.setAttribute('stroke', '#e0e1e3');
                    arc.setAttribute('stroke-width', 7);
                    arc.style.strokeDasharray = 4.5;
                    arc.setAttribute('fill', 'none');
                    if (this.completed) {
                        arc.setAttribute('stroke', '#ffb300');
                        arc.style.strokeDasharray = 'none';
                    }
                    element.append(arc);

                    let progressArc = document.createElementNS(xmlns, 'path');
                    progressArc.setAttribute('d', this._describeArc(
                        this.radius + 25,
                        this.radius + 25,
                        this.radius,
                        360 / this.numNodes,
                        (360 / this.numNodes) * (this.progress + 1)));
                    progressArc.setAttribute('stroke', '#ffb300');
                    progressArc.setAttribute('stroke-width', 7);
                    progressArc.setAttribute('fill', 'none');
                    element.append(progressArc);

                    this._drawStepCircles(svg, nodes, 20);
                });
            },
            _onProgressChanged (progress) {
                let index = progress || 0;
                if (!this.challengeSet || !this.challengeSet.challenges) {
                    this.set('selectedIndex', index);
                    return;
                }
                if (index < this.challengeSet.challenges.length) {
                    index = progress;
                } else {
                    index = this.challengeSet.challenges.length - 1;
                }
                let nextChallenge = this.challengeSet.challenges[index];
                if (nextChallenge) {
                    this.set('selectedIndex', index);
                    this.set('nextChallenge.title', nextChallenge.title);
                    this.set('nextChallenge.slug', nextChallenge.slug);
                }
                this._drawChallengeProgress();
            },
            _onChallengeClick (e) {
                let index = e.target.getAttribute('index');
                if (index <= this.progress) {
                    let selectedChallenge = this.challengeSet.challenges[index];
                    this.fire('open-kano-code', {
                        type: 'challenge',
                        slug: selectedChallenge.slug
                    });
                }
            },
            _openNextChallenge () {
                this.fire('open-kano-code', {
                    type: 'challenge',
                    slug: this.nextChallenge.slug
                });
            },
            _openFirstChallenge () {
                if (
                    !this.challengeSet
                    || !this.challengeSet.challenges
                    || !this.challengeSet.challenges.length
                ) {
                    return;
                }
                let challengeSlug = this.challengeSet.challenges[0].slug;
                this.fire('open-kano-code', {
                    type: 'challenge',
                    slug: challengeSlug
                });
            }
        });
    </script>
</dom-module>
